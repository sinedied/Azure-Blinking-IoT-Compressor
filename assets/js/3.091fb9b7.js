(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{271:function(e,t,s){e.exports=s.p+"assets/img/function-vscode-01.422e06ad.png"},272:function(e,t,s){e.exports=s.p+"assets/img/function-vscode-02.01cbd64f.png"},273:function(e,t,s){e.exports=s.p+"assets/img/function-vscode-03.cc6807ef.png"},274:function(e,t,s){e.exports=s.p+"assets/img/function-vscode-04.57192b07.png"},275:function(e,t,s){e.exports=s.p+"assets/img/function-vscode-05.c322458e.png"},276:function(e,t,s){e.exports=s.p+"assets/img/function-vscode-08.c41eff11.png"},277:function(e,t,s){e.exports=s.p+"assets/img/function-vscode-09.ecb7c21c.png"},278:function(e,t,s){e.exports=s.p+"assets/img/function-create-09.86ecec6b.png"},279:function(e,t,s){e.exports=s.p+"assets/img/function-create-10.01777615.png"},280:function(e,t,s){e.exports=s.p+"assets/img/function-create-01.ef0edcec.png"},281:function(e,t,s){e.exports=s.p+"assets/img/function-create-02.1fa705d2.png"},282:function(e,t,s){e.exports=s.p+"assets/img/function-create-03.d325bfec.png"},283:function(e,t,s){e.exports=s.p+"assets/img/function-deploy-01.bac3abee.png"},284:function(e,t,s){e.exports=s.p+"assets/img/function-deploy-02.d6f674dd.png"},285:function(e,t,s){e.exports=s.p+"assets/img/function-deploy-03.faf55eaf.png"},286:function(e,t,s){e.exports=s.p+"assets/img/function-deploy-04.ed96de2a.png"},287:function(e,t,s){e.exports=s.p+"assets/img/function-deploy-05.cec81f19.png"},288:function(e,t,s){e.exports=s.p+"assets/img/function-deploy-06.2c96e786.png"},289:function(e,t,s){e.exports=s.p+"assets/img/function-deploy-07.9be335bc.png"},290:function(e,t,s){e.exports=s.p+"assets/img/notpublish-friends-sticker.a0d3288f.png"},291:function(e,t,s){e.exports=s.p+"assets/img/function-deploy-14.c1e6996c.png"},292:function(e,t,s){e.exports=s.p+"assets/img/function-deploy-12.0f41e4cc.png"},293:function(e,t,s){e.exports=s.p+"assets/img/function-connect-01.57fdc14c.png"},294:function(e,t,s){e.exports=s.p+"assets/img/function-connect-02.a7cddfa1.png"},295:function(e,t,s){e.exports=s.p+"assets/img/connector.0c62b5fd.png"},315:function(e,t,s){"use strict";s.r(t);var n=s(4),r=Object(n.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"detectez-l-activite-du-compresseur-avec-azure-functions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#detectez-l-activite-du-compresseur-avec-azure-functions"}},[e._v("#")]),e._v(" D√©tectez l'activit√© du compresseur avec Azure Functions")]),e._v(" "),n("blockquote",[n("p",[e._v("Si vous r√©alisez ce workshop seul, sans quelqu'un de l'√©quipe relations\nd√©veloppeurs, alors il vous faudra r√©aliser le module 3 \"Connectez vos devices\nIoT au Cloud\" avant de r√©aliser ce module.")])]),e._v(" "),n("h3",{attrs:{id:"ce-que-l-on-cherche-a-realiser"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ce-que-l-on-cherche-a-realiser"}},[e._v("#")]),e._v(" Ce que l'on cherche √† r√©aliser")]),e._v(" "),n("p",[e._v("Nous avons d√©j√† connect√© les boards au cloud pour vous (vous pourrez le faire\nvous-m√™me dans le prochain module). Nous avons besoin de vous afin de d√©tecter\nd'apr√®s les donn√©es des capteurs si le compresseur est en fonctionnement ou non.")]),e._v(" "),n("p",[e._v("Vous allez donc d√©velopper une API REST √† l'aide d'Azure Functions qui sera appel√©e\nd√®s que la carte IoT enverra une nouvelle donn√©e. A vous de cr√©er un super algo\nqui retournera l'√©tat du compresseur üòÄ.")]),e._v(" "),n("h3",{attrs:{id:"qu-est-ce-qu-azure-function"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#qu-est-ce-qu-azure-function"}},[e._v("#")]),e._v(" Qu'est ce qu'Azure Function ?")]),e._v(" "),n("p",[e._v("Azure Functions est un des services "),n("em",[e._v("serverless")]),e._v(" d'Azure. Il vous permet de d√©velopper\ndes \"fonctions\" de code qui seront ex√©cut√©es √† la demande, avec un paiement √† l'usage\nainsi qu'un auto-scaling.")]),e._v(" "),n("p",[e._v("Il est possible de d√©velopper des Azure Functions avec un ensemble de langages: Java, Python, C#, Node.JS, etc...\nUne fois d√©velopp√©, les Azure Functions peuvent √™tre h√©berg√©es sur Azure, mais √©galement sur d'autres clouds, sur\nvos serveurs - via une image Docker - et m√™me sur des devices IoT !")]),e._v(" "),n("h3",{attrs:{id:"comment-developper-une-azure-function"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#comment-developper-une-azure-function"}},[e._v("#")]),e._v(" Comment d√©velopper une Azure Function ?")]),e._v(" "),n("p",[e._v("Vous avez deux possibilit√©s pour d√©velopper une Azure Function :")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("Via le portail Azure")]),e._v(": avec une exp√©rience enti√®rement dans votre navigateur. Cela est pratique\npour faire quelques tests, ou un petit PoC,")]),e._v(" "),n("li",[n("strong",[e._v("Sur votre poste de d√©veloppement (Windows, Mac, Linux)")]),e._v(": avec Visual Studio ou Visual Studio Code. C'est\nla solution recommand√©e pour des projets de production.")])]),e._v(" "),n("h2",{attrs:{id:"creer-une-fonction-dans-vs-code"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#creer-une-fonction-dans-vs-code"}},[e._v("#")]),e._v(" Cr√©er une Fonction dans VS Code")]),e._v(" "),n("p",[e._v("Visual Studio Code vous permet de cr√©er et de tester votre code en local, souvent sans acc√®s √† Internet. Il est ensuite\npossible de d√©ployer directement votre code dans une Azure function, ou via un pipeline d'int√©gration/d√©ploiement continu.")]),e._v(" "),n("p",[e._v("Si vous n'avez pas Visual Studio Code, vous pouvez √©galement "),n("a",{attrs:{href:"#creer-une-azure-function-%E2%9A%A1-dans-le-portail-azure-%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB"}},[e._v("d√©velopper votre fonction dans le portail Azure")]),e._v(".")]),e._v(" "),n("h3",{attrs:{id:"creer-le-projet"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#creer-le-projet"}},[e._v("#")]),e._v(" Cr√©er le projet")]),e._v(" "),n("p",[e._v("Pour cr√©er un projet Azure Functions, lancez la barre de commandes ("),n("em",[e._v("Ctrl+Shift+P")]),e._v("), et recherchez la commande\n"),n("code",[e._v("Azure Functions: Create New Project...")]),e._v(". Choisissez un r√©pertoire vide et r√©pondez aux options de cr√©ation du projet:")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("Le langage")]),e._v(": Vous pouvez choisir n'importe quel langage pour ce projet,")]),e._v(" "),n("li",[n("strong",[e._v("Le trigger")]),e._v(": C'est l'√©l√©ment qui va venir d√©clencher l'ex√©cution de votre fonction. Dans le cas d'une API REST, il\nfaudra s√©lectionner "),n("em",[e._v("HTTP trigger")]),e._v(",")]),e._v(" "),n("li",[n("strong",[e._v("Un nom de fonction")]),e._v(": Ce nom doit √™tre pr√©dictif (j'ai choisi "),n("code",[e._v("prediction")]),e._v("). Par d√©faut, ce sera √©galement une partie\nde l'URL")]),e._v(" "),n("li",[n("strong",[e._v("Le type d'autorisation")]),e._v(": Est-ce que votre fonction doit √™tre accessible sans authentification, ou avec une cl√©. Pour\nce workshop, vous √™tes libres de choisir l'une des deux m√©thodes, mais je vous encourage √† s√©lectionner "),n("em",[e._v("Function")]),e._v(". Prenons\nde bonnes habitudes üòÉ.")]),e._v(" "),n("li",[n("strong",[e._v("Comment souhaitez-vous ouvrir le projet")]),e._v(": dans une nouvelle fen√™tre VS Code ou dans la m√™me.")])]),e._v(" "),n("div",{staticClass:"img-inline"},[n("p",[n("img",{attrs:{src:s(271),alt:"",width:"200"}}),e._v(" "),n("img",{attrs:{src:s(272),alt:"",width:"200"}}),e._v(" "),n("img",{attrs:{src:s(273),alt:"",width:"200"}}),e._v(" "),n("img",{attrs:{src:s(274),alt:"",width:"200"}}),e._v(" "),n("img",{attrs:{src:s(275),alt:"",width:"200"}})])]),e._v(" "),n("p",[e._v("Une fois ces options choisies, VS Code va automatiquement vous cr√©er un squelette de projet et de fonction. Il ex√©cutera\nensuite des t√¢ches n√©cessaires en fonction du langage: cr√©er un environnement virtuel en python, faire un package restore\nen NodeJS ou en .Net, etc...")]),e._v(" "),n("p",[n("img",{attrs:{src:s(276),alt:""}})]),e._v(" "),n("p",[e._v("Sachez que le projet que vous venez de cr√©er peut contenir d'autres functions, quelque soit leur trigger mais avec\nle m√™me langage de programmation. Si vous souhaitez ajouter une nouvelle fonction, vous pouvez le faire\nvia la commande "),n("code",[e._v("Azure Functions: Create Function...")])]),e._v(" "),n("h3",{attrs:{id:"tester-et-debugguer-votre-projet"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tester-et-debugguer-votre-projet"}},[e._v("#")]),e._v(" Tester et d√©bugguer votre projet")]),e._v(" "),n("p",[e._v("Avant d'aller plus loin, nous allons tester que vous pouvez ex√©cuter et d√©bugger votre projet.\nSi votre environnement de d√©veloppement est correctement install√©, vous devriez pouvoir lancer la commande\n"),n("code",[e._v("Debug: Start debugging")]),e._v(" ("),n("em",[e._v("F5")]),e._v(") et l'h√¥te Azure Functions va alors se lancer. Vous verrez appara√Ætre dans le terminal\nl'adresse HTTP locale √† laquelle vous pouvez tester votre API.")]),e._v(" "),n("p",[n("img",{attrs:{src:s(277),alt:""}})]),e._v(" "),n("h2",{attrs:{id:"creer-une-azure-function-‚ö°-dans-le-portail-azure-üë©‚Äçüíª"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#creer-une-azure-function-‚ö°-dans-le-portail-azure-üë©‚Äçüíª"}},[e._v("#")]),e._v(" Cr√©er une Azure Function ‚ö° dans le portail Azure üë©‚Äçüíª")]),e._v(" "),n("p",[e._v("D√©velopper dans le portail n'est pas l'option recommand√©e pour un projet de production.\nVous pouvez √©galement "),n("a",{attrs:{href:"#creer-une-fonction-dans-vs-code"}},[e._v("d√©velopper votre fonction dans Visual Studio Code")]),e._v(".")]),e._v(" "),n("h3",{attrs:{id:"creer-l-application"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#creer-l-application"}},[e._v("#")]),e._v(" Cr√©er l'application")]),e._v(" "),n("p",[e._v("Avant de cr√©er une fonction, vous devez tout d'abord cr√©er un application. Depuis le\n"),n("a",{attrs:{href:"https://portal.azure.com?WT.mc_id=msroadshowwinter-event-yolasors",target:"_blank",rel:"noopener noreferrer"}},[e._v("portail Azure"),n("OutboundLink")],1),e._v('\n, cliquez sur le bouton (+) en haut √† gauche, recherchez "function" et choisissez "Function App". Vous pouvez √©galement\nutiliser le\n'),n("a",{attrs:{href:"https://portal.azure.com/?feature.customportal=false&WT.mc_id=msroadshowwinter-event-yolasors#create/Microsoft.FunctionApp",target:"_blank",rel:"noopener noreferrer"}},[e._v("lien direct"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("img",{attrs:{src:s(278),alt:""}})]),e._v(" "),n("p",[e._v("Une fois sur l'assistant de cr√©ation, vous aurez un certain nombre de questions auxquelles r√©pondre:")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("Un nom d'application")]),e._v(": ce nom servira √©galement √† g√©n√©rer une adresse en "),n("code",[e._v("mafonction.azurewebsites.net")]),e._v(". Il doit donc\n√™tre unique sur l'ensemble des utilisateurs d'Azure,")]),e._v(" "),n("li",[n("strong",[e._v("Un abonnement")]),e._v(": normalement, vous ne devriez avoir qu'un seul choix. Dans un contexte d'entreprise, il n'est pas rare\nd'avoir plusieurs abonnements - pour s√©parer les environnements par exemple,")]),e._v(" "),n("li",[n("strong",[e._v("Un resource group")]),e._v(": chaque ressource dans Azure doit √™tre plac√©e dans un conteneur logique. C'est le resource group,")]),e._v(" "),n("li",[n("strong",[e._v("Un Syst√®me d'exploitation")]),e._v(": Windows ou Linux. Cela influencera la liste des langages support√©,")]),e._v(" "),n("li",[n("strong",[e._v("Un plan")]),e._v(": C'est le mode de d√©ploiement de la fonction. S√©lectionnez "),n("em",[e._v("Consommation/comsumption")]),e._v(", ce qui vous permet\nd'avoir une facturation √† l'usage, ainsi qu'un auto-scaling,")]),e._v(" "),n("li",[n("strong",[e._v("La stack")]),e._v(": Node.Js, Java, .NET Core, Python. Faites votre choix !")]),e._v(" "),n("li",[n("strong",[e._v("Un emplacement")]),e._v(": Cela correspond √† la zone dans laquelle votre fonction sera d√©ploy√©e. On vous recommende "),n("em",[e._v("France\nCentral")]),e._v(" ou "),n("em",[e._v("Europe de l'Ouest")]),e._v(",")]),e._v(" "),n("li",[n("strong",[e._v("Un stockage")]),e._v(": laissez l'assistant en cr√©er un. Il sert notamment √† aggr√©ger les logs et synchroniser les diff√©rentes\ninstances qui h√©bergeront votre fonction.")])]),e._v(" "),n("p",[e._v("Il vous suffit alors de cliquer sur le bouton "),n("strong",[e._v("Create")]),e._v(" pour lancer la cr√©ation de l'application. Vous pouvez suivre\nl'√©volution en cliquant sur l'ic√¥ne en forme de cloche en haut √† droite.")]),e._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),n("p",[e._v("Un nouvel √©cran de cr√©ation d'une Function App est en cours de d√©ploiement. Bien que le design ait chang√©,\nles questions\npos√©es sont identiques.")])]),e._v(" "),n("p",[n("img",{attrs:{src:s(279),alt:""}})]),e._v(" "),n("p",[e._v("Une fois l'application de function cr√©√©e, vous serez alors en mesure de cr√©er votre premi√®re fonction. Dans l'assistant\nqui s'affiche, s√©lectionnez le mode d'√©dition "),n("strong",[e._v("In-portal")]),e._v(". On vous proposera alors un type de mod√®le, choisissez\n"),n("em",[e._v("Webhook + API")]),e._v(".")]),e._v(" "),n("div",{staticClass:"img-inline"},[n("p",[n("img",{attrs:{src:s(280),alt:"",width:"350"}}),e._v(" "),n("img",{attrs:{src:s(281),alt:"",width:"350"}})])]),e._v(" "),n("h3",{attrs:{id:"coder-et-tester-dans-le-navigateur"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#coder-et-tester-dans-le-navigateur"}},[e._v("#")]),e._v(" Coder et tester dans le navigateur")]),e._v(" "),n("p",[e._v('Vous aurez alors acc√®s √† un √©diteur de code. Le bouton "Save" vous permet d\'enregistrer vos modifications sur le serveur\net de les d√©ployer directement. Le bouton "Run" vous permet d\'ex√©cuter votre fonction, tout en voyant les logs en bas\nde la page et la requ√™te √† ex√©cuter √† droite.')]),e._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[e._v("Attention")]),e._v(" "),n("p",[e._v("Les raccourcis claviers, comme "),n("em",[e._v("Ctrl+S")]),e._v(" ne fonctionnent pas dans le navigateur. Oui c'est assez frustrant üòÉ.")])]),e._v(" "),n("p",[n("img",{attrs:{src:s(282),alt:""}})]),e._v(" "),n("p",[e._v("Vous pouvez maintenant passer √† l'√©tape de coder la fonction de pr√©diction d'activit√© du compresseur.")]),e._v(" "),n("h2",{attrs:{id:"ecrire-du-code-pour-detecter-l-activite-du-compresseur"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ecrire-du-code-pour-detecter-l-activite-du-compresseur"}},[e._v("#")]),e._v(" Ecrire du code pour d√©tecter l'activit√© du compresseur")]),e._v(" "),n("p",[e._v("Nous voulons maintenant √©crire un \"algorithme\" qui permettra de d√©tecter d'apr√®s les donn√©es de t√©l√©m√©trie si\nle compresseur est en fonctionnement ou pas. Nous vous laissons le soin de concocter l'algorithme !\nIl sera expos√© sous la forme d'une API REST, et sera appel√©e automatiquement par le "),n("em",[e._v("dispatcher")]),e._v(" que\nnous avons cr√©√©s.")]),e._v(" "),n("h3",{attrs:{id:"input-output"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#input-output"}},[e._v("#")]),e._v(" Input / Output")]),e._v(" "),n("p",[e._v("Votre API REST sera appel√©e par le dispatcher via une requ√™te POST, avec le body suivant:")]),e._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"deviceId"')]),e._v(" = "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"device-42"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"temperature"')]),e._v(" = "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("27.13")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"humidity"')]),e._v(" = "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("50.2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"pressure"')]),e._v(" = "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("1004.8")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("p",[e._v("Votre API doit retourner un JSON indiquant l'√©tat du compresseur, ainsi que la couleur de la LED √† afficher. L'id√©e est\nd'avoir une LED verte quand le compresseur est √©teint (aucun risque), puis rouge quand il est en fonctionnement\n("),n("em",[e._v("attention, compresseur sous tension")]),e._v(").")]),e._v(" "),n("p",[e._v("Le format de sortie attendu est le suivant:")]),e._v(" "),n("div",{staticClass:"language-json extra-class"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[e._v('"state"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"running"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[e._v('"led"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[e._v('"r"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[e._v('"g"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token property"}},[e._v('"b"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("p",[e._v("La propri√©t√© "),n("code",[e._v("state")]),e._v(" peut avoir comme valeurs "),n("code",[e._v("running")]),e._v(" ou "),n("code",[e._v("idle")]),e._v(". Les valeurs de la led doivent √™tre entre 0 et 255.")]),e._v(" "),n("h3",{attrs:{id:"quelques-exemples-d-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#quelques-exemples-d-api"}},[e._v("#")]),e._v(" Quelques exemples d'API")]),e._v(" "),n("p",[e._v("Si vous voulez tester une API d√©j√† r√©alis√©e, voici quelques endpoints.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("https://iotcompressor-evaluation.azurewebsites.net/api/AlwaysGreen\nhttps://iotcompressor-evaluation.azurewebsites.net/api/AlwaysGreen\nhttps://iotcompressor-evaluation.azurewebsites.net/api/AlwaysRed\nhttps://iotcompressor-evaluation.azurewebsites.net/api/Prediction?code=7j3bnVqlu2/KDArv8uTXadNfLqcNaTQEsIWeDTMvsD/8NL2sNQJoag==\n")])])]),n("h3",{attrs:{id:"quelques-exemples-de-code"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#quelques-exemples-de-code"}},[e._v("#")]),e._v(" Quelques exemples de code")]),e._v(" "),n("h4",{attrs:{id:"javascript"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#javascript"}},[e._v("#")]),e._v(" JavaScript")]),e._v(" "),n("p",[e._v("Cet exemple de JavaScript va simplement retourner que le compresseur est tout le temps\nen fonctionnement, et affiche une couleur de led rouge si la temp√©rature d√©passe les 30¬∞.")]),e._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[e._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("exports")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("async")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" req")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("'JavaScript HTTP trigger function processed a request.'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" temperatureRed "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("temperature "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("30")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        temperatureRed "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n    context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("res "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n            body"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"state"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"running"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"led"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" \n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"r"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" temperatureRed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"g"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"b"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),n("h2",{attrs:{id:"deployez-votre-fonction-dans-azure-‚òÅÔ∏è"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#deployez-votre-fonction-dans-azure-‚òÅÔ∏è"}},[e._v("#")]),e._v(" D√©ployez votre fonction dans Azure ‚òÅÔ∏è")]),e._v(" "),n("p",[e._v("Votre fonction est d√©sormais pr√™te pour le prime time ? Allons la d√©ployer sur Azure !")]),e._v(" "),n("blockquote",[n("p",[e._v("Comme indiqu√© pr√©c√©demment, nous allons ici la d√©ployer sur Azure, mais nous pourrions la d√©ployer\nsur d'autres environnements.")])]),e._v(" "),n("h3",{attrs:{id:"vous-l-avez-developpe-dans-le-portail-azure"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vous-l-avez-developpe-dans-le-portail-azure"}},[e._v("#")]),e._v(" Vous l'avez d√©velopp√© dans le portail Azure")]),e._v(" "),n("p",[e._v('Si vous avez √©crit votre fonction depuis le portail Azure, alors elle est automatiquement d√©ploy√©e √† chaque fois que\nvous appuyez sur le bouton "Save". Vous n\'avez donc rien √† faire !')]),e._v(" "),n("h3",{attrs:{id:"deployer-depuis-visual-studio-code"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#deployer-depuis-visual-studio-code"}},[e._v("#")]),e._v(" D√©ployer depuis Visual Studio Code")]),e._v(" "),n("p",[e._v("Si vous avez cr√©√© votre projet depuis Visual Studio Code, vous allez pouvoir de d√©ployer directement depuis l'√©diteur.\nPour cela, deux options :")]),e._v(" "),n("ul",[n("li",[e._v("Dans le menu contextuel sur l'arborescence, avec l'option "),n("strong",[e._v("Deploy to Function app")]),e._v(",")]),e._v(" "),n("li",[e._v("Depuis la barre de commandes avec la commande "),n("strong",[e._v("Azure Functions: Deploy to Function app")]),e._v(".")])]),e._v(" "),n("p",[e._v("Quel que ce choix de d√©part, la suite des √©tapes est identique.")]),e._v(" "),n("p",[n("img",{attrs:{src:s(283),alt:""}}),e._v(" "),n("img",{attrs:{src:s(284),alt:""}})]),e._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[e._v("Attention")]),e._v(" "),n("p",[e._v("Si vous n'avez jamais utilis√© Azure avec Visual Studio Code, il faudra connecter votre compte Azure √† VS Code.\nUn navigateur web devrait alors d'ouvrir vous demandant de vous connecter √† votre compte Azure.")])]),e._v(" "),n("p",[e._v("L'assistanv de VS code va alors vous poser un certain nombre de quesitons :")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("Dans quel abonnement d√©ployer l'application")]),e._v(": normalement, vous ne devriez avoir qu'un seul choix. Dans un contexte\nd'entreprise, il n'est pas rare d'avoir plusieurs abonnements - pour s√©parer les environnements par exemple,")]),e._v(" "),n("li",[n("strong",[e._v("Dans quelle Function app?")]),e._v(": nous allons ici en cr√©er une nouvelle,")]),e._v(" "),n("li",[n("strong",[e._v("Un nom d'application")]),e._v(": ce nom servira √©galement √† g√©n√©rer une adresse en "),n("code",[e._v("mafonction.azurewebsites.net")]),e._v(". Il doit donc\n√™tre unique sur l'ensemble des utilisateurs d'Azure,")]),e._v(" "),n("li",[n("strong",[e._v("Un emplacement")]),e._v(": Cela correspond √† la zone dans laquelle votre fonction sera d√©ploy√©e. On vous recommende "),n("em",[e._v("France\nCentral")]),e._v(" ou "),n("em",[e._v("Europe de l'Ouest")]),e._v(",")])]),e._v(" "),n("p",[n("img",{attrs:{src:s(285),alt:""}}),e._v(" "),n("img",{attrs:{src:s(286),alt:""}}),e._v(" "),n("img",{attrs:{src:s(287),alt:""}}),e._v(" "),n("img",{attrs:{src:s(288),alt:""}})]),e._v(" "),n("p",[e._v("VS Code va alors d√©ployer l'ensemble des ressources n√©cessaires √† l'h√©bergement de votre application, puis d√©ployer\nvotre code dans cette application. Cela peut prendre quelques minutes.")]),e._v(" "),n("p",[n("img",{attrs:{src:s(289),alt:""}})]),e._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),n("p",[e._v("Si vous avez effectu√© une modification de code et que vous souhaitez d√©ployer une mise √† jour, il suffit de suivre\nles m√™mes √©tapes, mais en s√©lectionnant l'applicaiton Azure Function d√©j√† cr√©√©e dans la liste.")])]),e._v(" "),n("h3",{attrs:{id:"deployer-depuis-la-ligne-de-commande-ou-la-cd-ci"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#deployer-depuis-la-ligne-de-commande-ou-la-cd-ci"}},[e._v("#")]),e._v(" D√©ployer depuis la ligne de commande ou la CD/CI")]),e._v(" "),n("p",[n("img",{attrs:{src:s(290),alt:""}})]),e._v(" "),n("p",[e._v("En environnement de production, il est rare de d√©ployer ces ressources via un clic-droit. Il est possible de d√©ployer\ndes Azure Functions depuis une ligne de commande ou bien depuis un pipeline de CD/CI.")]),e._v(" "),n("h3",{attrs:{id:"recuperer-l-url-de-la-fonction"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#recuperer-l-url-de-la-fonction"}},[e._v("#")]),e._v(" R√©cup√©rer l'URL de la fonction")]),e._v(" "),n("p",[e._v("Via la barre \"Azure\" (celle avec un logo A dans la barre lat√©rale gauche), il est possible d'explorer l'ensemble des\nAzure Functions de ses souscriptions. Un clic droit sur la fonction permet alors de r√©cup√©rer l'URL √† appeler.")]),e._v(" "),n("p",[n("img",{attrs:{src:s(291),alt:""}})]),e._v(" "),n("p",[e._v("Si vous avez choisi un mode d'autentification "),n("code",[e._v("Function")]),e._v(", cette URL contiendra alors directement la cl√© d'API.")]),e._v(" "),n("h3",{attrs:{id:"streamer-les-logs-depuis-azure"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#streamer-les-logs-depuis-azure"}},[e._v("#")]),e._v(" Streamer les logs depuis Azure")]),e._v(" "),n("p",[e._v("Une fois votre fonction d√©ploy√©e, il est possible de streamer ces logs directement depuis Visual Studio Code.\nPour cela, il suffit de cliquer sur le bouton dans la notification ou d'utiliser la commande\n"),n("strong",[e._v("Azure Functions: Start Streaming Logs")]),e._v(".")]),e._v(" "),n("p",[n("img",{attrs:{src:s(292),alt:""}})]),e._v(" "),n("h2",{attrs:{id:"connectez-votre-function-a-tailwind-diving-üè≠"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#connectez-votre-function-a-tailwind-diving-üè≠"}},[e._v("#")]),e._v(" Connectez votre function √† Tailwind Diving üè≠")]),e._v(" "),n("p",[e._v("Maintenant que votre Azure Function de pr√©diction est pr√™te, il est temps de la connecter au service !\nComme indiqu√© pr√©c√©demment, nous avons d√©j√† connect√© votre board √† Azure. Il faut donc maintenant\nque notre syst√®me connaisse votre board afin de pouvoir appeler votre fonction √† la r√©ception\nd'une nouvelle donn√©e de t√©l√©m√©trie.")]),e._v(" "),n("h3",{attrs:{id:"recuperer-l-adresse-de-son-azure-function"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#recuperer-l-adresse-de-son-azure-function"}},[e._v("#")]),e._v(" R√©cup√©rer l'adresse de son Azure Function")]),e._v(" "),n("p",[e._v("L'adresse de votre Azure Function est compos√©e de diff√©rentes parties :")]),e._v(" "),n("ul",[n("li",[e._v("Le nom de votre application (choisi au moment de la cr√©ation), suivi de "),n("code",[e._v("azurewebsites.net")]),e._v(",")]),e._v(" "),n("li",[e._v("un pr√©fixe, souvent "),n("code",[e._v("api")]),e._v(",")]),e._v(" "),n("li",[e._v("le nom de votre m√©thode,")]),e._v(" "),n("li",[e._v("si votre fonction est prot√©g√©e, la cl√© de fonction (propre √† chaque fonction), ou une des "),n("em",[e._v("master keys")]),e._v(" permettant\nd'acc√©der √† l'ensemble des fonctions de l'application.")])]),e._v(" "),n("p",[e._v("Le plus simple pour r√©cup√©rer l'adresse est de se rendre dans le portail Azure sur votre application. Choisissez ensuite\nvotre fonction et cliquez sur le lien **Get Function **.")]),e._v(" "),n("p",[n("img",{attrs:{src:s(293),alt:""}})]),e._v(" "),n("p",[e._v("La popup qui s'ouvre alors contient le chemin vers votre fonction, et √©ventuellement avec la cl√©e de fonction. Copiez\ncette URL pour la prochaine √©tape.")]),e._v(" "),n("p",[n("img",{attrs:{src:s(294),alt:""}})]),e._v(" "),n("blockquote",[n("p",[e._v("Bien √©videmment, il est possible de d√©ployer une Azure Function avec son propre nom de domaine, mais √©galement\navec ses propres pr√©fixes ou chemins. La preuve ? "),n("a",{attrs:{href:"https://www.maneu.fr/?wt.mc_id=blinkingcompressor-github-chmaneu",target:"_blank",rel:"noopener noreferrer"}},[e._v("maneu.fr"),n("OutboundLink")],1),e._v("\nn'est qu'une Azure Function :smiling:.")])]),e._v(" "),n("h3",{attrs:{id:"enregistrer-son-webhook"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#enregistrer-son-webhook"}},[e._v("#")]),e._v(" Enregistrer son webhook")]),e._v(" "),n("p",[e._v("Nous avons d√©velopp√©s un "),n("a",{attrs:{href:"https://backend-registrationwebsite.azurewebsites.net/",target:"_blank",rel:"noopener noreferrer"}},[e._v("petit site"),n("OutboundLink")],1),e._v(" qui vous permet d'enregistrer votre webhook. Il suffit\nde s√©lectionner votre device dans la combo (son n¬∞ est inscrit au dos de la board), et de coller l'URL de votre\nAzure Function. Si vous souhaitez que votre webhook soit appel√© pour test, il vous suffit de cliquer sur\n\"Test Callback Url\".")]),e._v(" "),n("p",[n("img",{attrs:{src:s(295),alt:""}}),e._v(" "),n("a",{attrs:{href:"https://backend-registrationwebsite.azurewebsites.net/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://backend-registrationwebsite.azurewebsites.net/"),n("OutboundLink")],1)]),e._v(" "),n("h3",{attrs:{id:"tester-son-fonctionnement"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tester-son-fonctionnement"}},[e._v("#")]),e._v(" Tester son fonctionnement")]),e._v(" "),n("p",[e._v("D√©sormais, votre Azure Function devrait √™tre appel√©e √† chaque r√©ception de donn√©e t√©l√©m√©trique du device. En situation normale\n(version de code 0.2), cela arrivera environ toutes les 10 secondes. Vous pouvez streamer les logs (depuis VS Code ou\nle portail) pour voir l'ex√©cution de votre fonction.")]),e._v(" "),n("p",[e._v("Pour changer les valeurs de votre board, il suffit g√©n√©ralement d'appliquer l'un de vos doigts sur le capteur de temp√©rature.\nSi cela ne suffit pas, vous pouvez frotter votre doigt contre la paume de la main pour le r√©chauffer.\nPenez √† laisser votre doigt plusieurs secondes, les donn√©es n'√©tant pas envoy√©es √† chaque seconde.")]),e._v(" "),n("h3",{attrs:{id:"c-est-reussi"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#c-est-reussi"}},[e._v("#")]),e._v(" C'est r√©ussi ?")]),e._v(" "),n("p",[e._v("Si votre board change bien de couleur selon votre algorithme, c'est gagn√© ! Passons au prochain module üöÄ.\nDans le cas contraire, faites appel √† l'un des assistants afin de comprendre pourquoi cela ne fonctionne pas.")])])}),[],!1,null,null,null);t.default=r.exports}}]);